## Defense Evasion
* Consists of techniques that adversaries use to avoid detection throughout their compromise
* These include:
  * Uninstalling/disabling security software or
  * obfuscating/encrypting data and scripts
 
* Adversaries also leverage and abuse trusted processes to hide their malware - MITRE

* **How AV detection methods work**
1. Signature based detection:
   * **What is an AV signature**:
     * It is a unique sequence of bytes that uniquely identifies malware.
     * Any obfuscated exploit or payload that matches any known signature in the AV database
    
   * **How to bypass**
     * By modifying the malware's byte sequence, therefore chanign the sequence.
    
2. Heuristic-based etection
   * Relies on rules or decisions to determine whether a binary is malicious.
   * It also looks for specific patterns within the code or program calls.
  
3. Behaviour-based detection
   * Identifies the malware by monitoring it's behaviour
  
## AV Evasion techiques
### On-disk evasion techniques
1. **Obfuscation**
   * The process of concealing something valuable or critical
   * Obfuscation reorganizes code in order to make it harder to analyze or RE.
  
2. Encoding
   * A process to change the data into a new format.
   * It is a reversible process --> the data can be decoded to its original format
  
3. Packing
   * Generate executable with new binary structure with a smaller size --> which provides the payload with a new signature.
  
4. Crypters
   * It encrypts code or payloads and decrypts the encrypted code in memory
   * The decryption key/function is usually stored in a stub.
  
### In-memory evasion techniques
* Focuses on manipulation of memory and does not write files to disk
* Injects payload into a process by leveraging various Windows APIs
* Payload is executed in memory in a separate thread.

* PRACTICAL
* `www.shellterproject.com`
* `sudo apt-get install shellter -y`
* As shellter is a windows executables --> We need Wine to run it on a Linux system
* `sudo dpkg --add-architecture i386`
* `sudo apt-get install wine32`

* We can see the executables through which we can upload the payload under:
  * `/usr/share/windows-binaries/`
  * We'll go with "vncviewer.exe" to inject our shellcode in it.
 
* Copy this file to a folder "AV bypass" just for more clarity.
* `cd /usr/share/windows-resources/shellter`
* `sudo wine shellter.exe`
* Provide the path to the executable vncviewer.exe
* Then it will ask if we want to enable the Stealth mode --> Mode which tells if we want to executable to display its normal behaviur along with executing our payload code. --> Y
* Then select the payload --> L --> Enter the index of the payload
* Injection verified
* Now we can transfer the injected executable to the target.
* Start a web server on the attacker
* `python3 -m http.server 80`
* `msfconsole`
* `use exploit/multi/handler`
* `run`
* Open the target: 
* In the browser: `[target IP]` --> Download the vncviewer.exe
* On executing it on the target, we can get a meterpreter session the multi/handler listener.
